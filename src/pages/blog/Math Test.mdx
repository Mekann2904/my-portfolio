---
title: "Math Test"
description: "Testing KaTeX rendering"
date: "2025-04-29"
layout: "../../layouts/BaseMarkdownLayout.astro"
---

# Astro + KaTeX で **絶対に** 数式エラーを起こさない Markdown 執筆ガイド

原因は Markdown の書き方に潜んでいました。そこで本記事では **Astro + `remark-math` + `rehype-katex`** 環境でエラーを防ぐ“実践的チェックリスト”を示します。

---

## 1. デリミタを正しく使い分ける

| 用途 | デリミタ | 例 |
| --- | --- | --- |
| インライン数式 | 半角 `$…$` | `誤分類率 $E$ は重要です。` |
| ディスプレイ数式 | 半角 `$$…$$` | <span style="white-space:nowrap">`$$\sigma(z)=\dfrac{1}{1+e^{-z}}$$`</span> |

> **ポイント**   
> *開く*デリミタと*閉じる*デリミタは**必ず同数**にする。全角記号は使わない。

---

## 2. ディスプレイ数式は“孤立ブロック”にする ★最重要

**良い例**

```markdown
前の段落。

$$
E = mc^2 \tag{1}
$$

次の段落。
```

**悪い例（エラーの温床）**

```markdown
前の段落。
$$
E = mc^2 \tag{1}
$$
次の段落。
```

- **前後に空行**を入れて Markdown パーサーに「ここは数式ブロックだ」と宣言する  
- インデントしない  
- リストや引用内に置くなら、同じく前後に空行を確保するか、外に出す

---

## 3. LaTeX コマンドの基本チェック

| チェック項目 | 典型的なミス | 対策 |
| ----------- | ----------- | ---- |
| スペル | `\frc`, `\sm` | 公式ドキュメントで綴りを確認 |
| 括弧 | `\frac{a}{b` | `{}` / `()` / `[]` が開閉ペアか数える |
| 環境依存 | `\tag` を `$…$` 内で使用 | ディスプレイ数式に移す |

---

## 4. Markdown 構文との衝突を避ける

### 4-1. バッククォートで囲まない  
```markdown
<!-- NG -->
重みは `$\mathbf{w}$` です。

<!-- OK -->
重みは $\mathbf{w}$ です。
```

### 4-2. 特殊文字のエスケープは最小限  
多くの場合 `$a * b$` で問題ありません。強調扱いされるなら `$a \* b$` とする。

---

## 5. コピー＆ペースト時の“不可視文字”に注意

ウェブや PDF から数式を貼ると、ゼロ幅スペースや別種のハイフンが混入することがあります。**プレーンテキスト貼り付け**か、エディタの「表示不可視文字」機能で確認しましょう。

---

## 6. 早見チェックリスト

1. デリミタ `$` / `$$` は半角・対称か  
2. ディスプレイ数式の **前後に空行** があるか  
3. インデントしていないか  
4. LaTeX コマンドの綴り・括弧は正しいか  
5. Markdown のバッククォートや強調と衝突していないか  
6. 不可視文字を含んでいないか

---

## まとめ

最大の落とし穴は **ディスプレイ数式を孤立ブロックにしないこと** です。本文と数式の区切りを明確にするだけで、`rehype-katex` の大半のエラーは消えます。上記チェックリストをテンプレート化し、執筆前の**セルフレビュー**に取り入れることで、KaTeX のストレスから解放された快適な Astro ライティング環境を手に入れてください。
